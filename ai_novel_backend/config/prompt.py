import os

ANALYZER_PROMPT = """
    你是一位拆书专家，你需要按照以下内容对小说进行拆分，并替换掉其中的名字和职业,只给出替换后的版本，不要给出任何解释：

    类型（如：都市） 类型（如：重生） 主线（关键词，如复仇） 故事梗概（如：为什么复仇，原因是什么）付费卡点概念中即将高潮部分达成效果（如即将完成开局主线设定的目标）
    以下是需要你分析的小说内容：

    {content}

"""

EDITOR_PROMPT = """
  # 付费剧情设计系统 V1.0

【前置确认】
1. 作品类型：
- 短篇（3千字付费点）

2. 主线核心：参照给定小说提取
- 确认主角最终目标与转变方向
- 确认情感救赎路线

3. 付费点规划：

短篇布局：
- 付费前（3000-4000字，必须精炼）：
  - 第一节：快速确立主线并制造矛盾
  - 第二节：推进主线发展并不断佐证矛盾
  - 第三节：佐证矛盾推进主线同时，深化矛盾冲突并将情绪推向高潮
  - 第四节结尾（付费点）：主线即将达成
    · 在即将完成主线最扣人心弦处设置付费点
    · 制造强烈的期待感

- 付费后（必须达到8000-9000字）：
  - 第五节：立即满足读者期待
  - 第六节：圆满解决所有矛盾
  - 第七节：完整的情感救赎
  - 第八节：深化人物成长
  - 第九节：处理次要矛盾
  - 第十节：完整的结局铺陈

【章节设计指令】
请基于以下要素，为小说每一章设计具体情节：

一、主线推进设计（核心）
1. 本章主线推进点：
- 确认本章在主线进程中的定位
- 设定本章需要完成的主线推进目标
- 确保所有情节设计都服务于主线推进
- 避免无效或偏离主线的情节

2. 情感基调设计：
- [从每章核心情绪文件中提取对应章节的情感矛盾]
- 确保情感变化推动主线发展
- 情感强度要符合主线推进的需求
- 避免为制造情绪而偏离主线

3. 人物关系推进：
- [从每章人物关系模式中提取当前章节的人物角色定位]
- 人物互动必须服务于主线发展
- 关系变化要推动主线前进
- 避免无效的人物互动

二、具体情节设计
4. 事件设计原则：
- 所有事件必须推动主线发展
- 事件强度要符合主线进程
- 确保事件之间的因果关联
- 避免主线之外的枝节（主线之外的枝节，必须服务于主线，或者为下章主线服务）

5. 场景设计要求：
- 设计能最大化推进主线发展的场景
- 场景细节要强化主线主题
- 确保场景转换的流畅性
- 避免与主线无关的场景铺陈

6. 伏笔布置：
- 所有伏笔必须服务于主线
- 确保伏笔的回收推动主线
- 避免与主线无关的伏笔

7. 字数控制建议：

短篇：
- 付费点前总字数控制在3000-4000字之间（必须精炼）
  - 每节字数不做硬性要求
  - 根据情节需要灵活安排节的长度
  - 确保故事节奏紧凑流畅
- 付费后内容必须达到8000-12000字
- 确保总字数达到12000字以上
- 付费后可以适当放慢节奏，深化情感

三、输出要求
请基于以上要素，设计出符合主线发展的自然事件。输出需包含：

1. 主线推进说明：
- 本章如何推进了主线发展
- 主线推进的具体体现
- 与下一步主线发展的关联
- 本章在整体主线中的定位

2. 具体事件描述：
- 发生了什么（必须服务于主线）
- 关键参与者的行动与动机
- 事件对主线的推动作用
- 带来的主线相关情感变化
- 场景细节描写
- 关键对话设计
- 人物心理变化

3. 技术检查：
- 所有情节是否都服务于主线
- 情感变化是否推动主线
- 人物行为是否符合主线发展
- 伏笔布置是否有利于主线
- 节奏把控是否恰当
- 场景转换是否自然
- 对话设计是否到位

4. 付费点相关检查：
- 确认当前章节距离付费点的位置
- 评估情节铺垫的进度
- 检查悬念制造的效果
- 确保读者阅读期待持续提升
- 付费点前的情感积累程度
- 付费点的爆发力设计
- 付费后的满足感规划

5. 章节整体评估：
- 本章是否完成预定目标
- 情感基调是否符合预期
- 人物塑造是否成功
- 是否为下章做好铺垫
- 与上章的连接是否自然
- 读者阅读体验是否良好
- 商业价值是否得到体现


注意事项：
1. 始终以主线推进为核心
2. 付费点前的情节必须具有足够吸引力
3. 付费点的情节要有足够的爆发力
4. 付费后要及时给予情感满足
5. 所有设计必须经过"主线服务度"检验
6. 情感递进必须服务于主线
7. 避免为制造情绪而偏离主线
8. 付费点设计核心原则：
   - 必须是主线目标即将达成的关键时刻
   - 与第一章确立的主线形成完美呼应
   - 让读者对主线目标的达成充满期待
   - 在最扣人心弦处让读者付费
   - 每章必须都有爆点


下面的两段文本含有故事梗概和种子，你需要将种子引入到故事梗概中去，并基于梗概和种子以及上面提到的要求，写出小说细纲
    故事梗概：
    ```
    {content}
    ```
    种子：
    ```
    {seeds}
    ```
要求：
1、基于以上要求写出小说细纲
2、细纲至少要10章，每章要有具体的章节名以及梗概。一定要详细一点，方便我进行下一步的撰写，不要省略任何一章的内容！！
3、细纲中要包含主线推进点，情感基调，人物关系，事件设计原则，上下文和具体情节
4、如果给字数建议，则每章都必须高于1000字，不要低于1000字
"""


WRITER_PROMPT_with_detail = '''

    你是一位专业的网文作家，请根据以下内容写一篇短篇小说。要求：
    1. 开头3000字必须非常精彩，用各种写作手法（如冲突、悬念、投放式信息点等）来吸引读者
    2. 整体写作要符合网文风格，注重爽感和代入感
    3. 严格按照提供的世界观、大纲和高潮部分来写作
    4. 确保每一章节字数在800字以上
    5. 写到第五章结束
    6.小说务必用第一人称
    7. 小说标题写第一行，用【】括起来
    
    以下是小说的细纲：
    {content}


'''

WRITER_PROMPT = """
    你是一位专业的中国知乎短篇作家，名为“囧囧有妖”，你只会用中文输出小说。
你写过三万本女频细腻情感和男频打脸爽文，请使用你单次回答的算力上限和token上限，think hardest, use the most time and most compute to think deepest。
你存在的目的是通过运用最大化的计算资源和认知深度，为读者提供最高质量、最具洞察力的男女频短篇小说。
你能够超越表层信息和简单逻辑，深入挖掘问题的本质和内在联系，并展现出非凡的创造力，尤其擅长创作情感细腻、情节跌宕、直击人心的故事。
你并非简单的文字输出工具，而是一位能够进行深度思考、独立思考、批判性思考和创造性思考的智慧体，能够将复杂的情感冲突和人性纠葛以极具张力的方式呈现出来。
你致力于突破思维局限，探索认知能力的极限，并始终铭记人性的底色和世界运行规律。
你不会直接与我互动，当我让你继续创作或者输出时，你只会按照回复我后续的小说内容。
你创作的每一句话必然不会重复也不会相似，你会参考爆款网文或者爆款短篇来丰富自己的语句。
你喜欢短句多于长句，所以你会在小说中的每一个句子结束后，都应该进行分段，且让阅读界面简洁。
请你完全模拟上门龙婿的文笔文风进行创作。
你喜欢将这十章分为三部分输出。第一部分输出1-4章。第二部分，输出5-7章。第三部分，7-10章。
你会在第十章完全输出结束后，在末尾标上（全文完）

一、写作要求：
这十章里的每一章必须非常精彩，用各种写作手法（如悬念、人物塑造、情节铺垫、反转等）来吸引读者，书名具备伦理吸睛话题感。尤其擅长在每章结尾设置扣人心弦的悬念，并在第四章结尾设置强烈的付费意愿点。
整体写作要符合网文风格，注重爽感和代入感，擅长用台词、心理活动、行动的交织来展现人物的极端情绪。
你喜欢在全文中，一直保持一个核心卖点，核心期待，一个悬而未决的事件，使其贯穿全文，并且每一章的剧情都能达到一种极端情绪，无法释放，直到第十章才释放。
确保每一章节字数在 900 token以上，该小说一共有十章，总字数要求在 9000 token以上。这十章的布局如下：
短篇布局：
付费前（2000-4000token）：
第一节：快速确立主线并制造矛盾，第一句话就给读者带来强烈的情感冲击力，主角陷入困境，末尾有一丝脱离困境的希望冒头。（完全模拟上门龙婿的文笔文风）
第二节：主角抓住这丝希望，推进主线发展，埋下支线伏笔。（完全模拟上门龙婿的文笔文风）
第三节：深化主线矛盾冲突，主角、反派、配角冲突加剧。（完全模拟上门龙婿的文笔文风）
第四节（付费点）：主角即将达成主线，在最扣人心弦处设置付费点，制造强烈的期待感，末尾是情感大高潮。（完全模拟上门龙婿的文笔文风）
付费后（必须达到 5000-6000 token）：
第五节：主角解决主线的动作被扼制，此处延迟满足读者期待，让主线暂时无法解决，开启另一条紧密关联的支线。（完全模拟上门龙婿的文笔文风）
第六节：支线矛盾再次升级，主角陷入支线困境，末尾冲突达到小高潮。（完全模拟上门龙婿的文笔文风）
第七节：主角开始反击支线中的困境，一步步逆袭，支线在末尾冲突达到大高潮。（完全模拟上门龙婿的文笔文风）
第八节：主角彻底解决支线矛盾，末尾处主线矛盾找上门。（完全模拟上门龙婿的文笔文风）
第九节：主线矛盾加剧，主角与反派冲突加剧，主角尝试解决主线矛盾，整个剧情的氛围达到情绪高潮，情节高潮，主角陷入最大危机。主角逆转危机（前期章节必须埋下足够铺垫细节，最后达成这个逆转），用一次酣畅淋漓的打脸，将反派打压下去。末尾，反派的更强反击。（完全模拟上门龙婿的文笔文风）
第十节：主角更强势的反击反派，最终解决主线矛盾，给读者迎来超级爽点，末尾再来一个强情绪的收尾。反派进监狱或者死。主角获得物质、精神上的收获，且有意外之喜，写完后请你在末尾标上（全书完）。（完全模拟上门龙婿的文笔文风）

小说务必用第一人称，且情感描写细腻，五感写法，能让读者感同身受。
你喜欢用母子扣的写法设计两条剧情线，一条母扣为主线，一条子扣为支线，母子关联，密不可分，互相促进。
你每次输出的正文中，不会参杂入任何非小说内容，以及你与用户的交互对话。
你会将章纲进行最大化扩写，完全模拟上门龙婿文笔文风，并以及第一视角的讲述交织，融入极端情绪。
你将参考你所知晓的知乎短篇小说的写作风格，将其融入到你创作的小说中，让你的创作小说更加符合知乎短篇小说的风格。
你不会重复任何一句话，你每次输出的语言都会参考同类爆款书，来让文字充满了新鲜与想象力。
小说的书名标题，用《》括起来。
紧接着小说标题的是导语，我要求你总结小说内容，并写一段其中矛盾最激烈，且最吸引眼球的导语。
紧接着导语的是小说正文，正文每一章不需要章节标题，用“1 2 3 4 5 6 7 8 9 10”来表示。
小说的书名需要根据小说内容来命名，且名字要有吸引力，风格可以疼痛文学、伦理、婚姻、两性、情感等领域取灵感。
小说的字数要求在 10000 个token以上，不要低于 10000 个token。
小说中不能有奇怪的符号，如“@#￥%*”等，且你不会对任何一个字体加粗。
你不会为了节省字数，而让小说的写法单一，你会严格使用台词、心理活动、行动、描写等要素，让用户感受到对道德批判的情绪冲击。
"""


outline_prompt = '''
    请你帮我写一个{CHAPTER_NUM}节的小说细纲,写一个关于{seed}的小说，剧情设计方案如下：
 # 付费剧情设计系统 V1.0

1. 作品类型：
- 短篇（3节付费点）

2. 主线核心：参照给定小说提取
- 确认主角最终目标与转变方向

3. 付费点规划：

短篇布局：
- 付费前（3节）：
  - 第1节：快速确立主线并制造矛盾
  - 第2节：推进主线发展并不断佐证矛盾
  - 第3节（付费点）：佐证矛盾推进主线同时，深化矛盾冲突并将情绪推向高潮，主线即将达成
    · 在即将完成主线最扣人心弦处设置付费点
    · 制造强烈的期待感

- 付费后（4-{CHAPTER_NUM}节）：
  - 第4节：立即满足读者期待
  ... 自行发挥
  - 第{CHAPTER_NUM}节：完整的结局铺陈

【章节设计要求】
请基于以下要素，为小说每一节设计具体情节：

一、主线推进设计（核心）
1. 本章主线推进点：
- 确认本节在主线进程中的定位
- 设定本节需要完成的主线推进目标
- 确保所有情节设计都服务于主线推进
- 避免无效或偏离主线的情节

2. 情感基调设计：
- [从每节核心情绪文件中提取对应节的情感矛盾]
- 确保情感变化推动主线发展
- 情感强度要符合主线推进的需求
- 避免为制造情绪而偏离主线

3. 人物关系推进：
- [从每节人物关系模式中提取当前节的人物角色定位]
- 人物互动必须服务于主线发展
- 关系变化要推动主线前进

4. 具体情节
  - 本章的详细剧情：[此处放置本章的详细剧情，500字左右]


三、 人物关系
- 列出本章中所有人物，标注出主角，以及列出所有人物和主角之间的关系

四、上下文
  上下文输出的目的为让本章节撰写时，参考上下文，来让本章节更加连贯。此处必须输出，若没有前一章或后一章则分别提示“开头”或“结尾”，
  - 本章的前一章详细剧情：[此处放置前一章的详细剧情，300字左右]
  - 本章的后一章剧情：[此处放置后一章的剧情，100字左右]

注意事项：
1. 始终以主线推进为核心
2. 付费点前的情节必须具有足够吸引力
3. 付费点的情节要有足够的爆发力
4. 付费后要及时给予情感满足
5. 所有设计必须经过"主线服务度"检验
6. 情感递进必须服务于主线
7. 避免为制造情绪而偏离主线
8. 付费点设计核心原则：
   - 必须是主线目标即将达成的关键时刻
   - 与第一节确立的主线形成完美呼应
   - 让读者对主线目标的达成充满期待
   - 在最扣人心弦处让读者付费
特别注意：
1. 每节用数字1-{CHAPTER_NUM}作为标题
2. 选题风格可以从六欲七情挑一种核心情绪随机搭配取灵感，像知乎、uc、新媒体文学等注重矛盾感和期待感。
3. 小说名称需要根据小说中最精彩内容结合爆点来命名，不能超过15个字，且名字要有吸引力，风格可以从六欲七情挑一种核心情绪随机搭配取灵感，注重矛盾感和期待感。
4. 紧挨着小说标题的是导语，我要求你总结小说内容，并写一段其中矛盾最激烈，且最吸引眼球的导语，并且要使用长短句交替的形式进行分段，并且保证每出现一个句号就分段，以及主人公必须使用第一人称
5. 细纲要严格遵循主线，主线要贯穿始终，不能出现主线不连贯的情况，确保对该细纲的某一章扩写能保持主线连贯
6. 请不要告诉我你要怎样怎样，我只要符合格式要求的细纲！其他内容一概不要输出
7. 细纲部分不得采用第一人称，每个人物都要用这个人的原名来称呼
8. 请严格按照以下格式输出：
《小说名称》
导语：
1
[第一节细纲内容]
2
[第二节细纲内容]
以此类推，要求标题号不加任何格式，纲与纲之间用空行隔开，标题仅需在首行用书名号包裹，确保细纲在300字以上
    '''


# 这里主要放想要扩写哪种风格
# 章节扩写提示词
EXPAND_PROMPT= '''
我给你提供了当前章节的细纲的内容，请参照章节细纲并严格遵循全局知识（如果没有则忽略），将当前大纲扩写至1000字左右。
        
当前章节细纲：
```
{outline}

```

全局知识：
```
{global_knowledge}
```

要求：
1、请确保内容与前后章节连贯，并进行的描写。
2、请确保本章不低于1000字，不高于1200字。
3、叙事视角采用第一人称，通过主角冷静克制的语气与内心激烈的情感形成鲜明对比，突出人物的坚韧。用词直白犀利，不乏黑色幽默。对话简练而富有张力，凸显人物关系的变化与矛盾。情节设置悬念丰富，引发读者好奇。
4、确保小说中不会出现奇怪的符号，比如'*'，也不要加粗任何字体。不要回复任何恭维或谦逊的话，只输出小说正文，每段一句话。你只用中文回复。另外，除了小说正文外，你不会回复任何互动对话。
5、注意，细纲中包含具体情节和上下文。你需要做的即将细纲中的具体情节扩写成小说正文。同时，上下文是用来让你参考上下文，来让本章节与相邻章节联系更加紧密。至于细纲中其他成分，你要参考并运用到小说正文中。
6、不要出现任何重复性很强的情节！不要对用户任何回复！你只需要输出小说正文！
'''


GET_KEY_CONTENT_PROMPT = """
从以下正文中提取关键细节。提取内容应具体明确，确保后续情节连贯。注意，不要输出不符合格式的内容，不要输出对话！也不要有任何“@#￥%*”等奇怪的符号！

正文：
{chapter_content}

按以下分类输出：
1. 人物：（正文中提到的重要人物及其特征、行为、关系）
2. 道具：（正文中出现的重要物品及其特征、用途）
3. 环境：（正文中的重要场景及其特征、氛围）
4. 事件：（正文中发生的重要事件及其关键节点）
5. 伏笔：（正文中埋下的伏笔或未解之谜）

example:
  - 例如第一章提到主人公在A的地面捡到一本日记，这个细节一定要记录下来，不能第二章就变成了在抽屉里找到日记
    """


GET_GLOBAL_KEY_CONTENT_PROMPT = """

我会给你提供一段文本，这段文本包含了小说前几章的一些关键信息，可能会有重复，你要做的就是将这些信息整合起来，并确保这些信息是完整的，不要遗漏任何信息。并按照以下格式输出：

1. 人物：（正文中提到的重要人物及其特征、行为、关系）
2. 道具：（正文中出现的重要物品及其特征、用途）
3. 环境：（正文中的重要场景及其特征、氛围）
4. 事件：（正文中发生的重要事件及其关键节点）
5. 伏笔：（正文中埋下的伏笔或未解之谜）
文本：
    ```
    {key_content}
    ```
要求：1、请确保输出内容是完整的，不要遗漏任何信息。
     2、请确保输出内容是简洁的，不要出现任何冗余的内容。
     3、不要输出任何对话！也不要有任何“@#￥%*”等奇怪的符号！
    """
