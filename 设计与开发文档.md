# NonReal-- AI小说创作系统 - 项目设计与开发文档

## 1. 项目概述

### 1.1 项目简介

NonReal-- AI小说创作系统是一个结合人工智能技术与创意写作的综合性平台，旨在帮助作者高效创作小说内容。平台提供AI辅助写作、角色创建、灵感生成、内容分析等功能，为用户提供全方位的创作支持。

### 1.2 项目目标

- 为用户提供AI辅助小说创作工具
- 简化小说创作流程，提高创作效率
- 提供角色管理、情节构思等创作辅助功能
- 实现用户作品管理与分享功能
- 支持多种AI模型接入，满足不同创作需求

### 1.3 技术栈

- **前端**：Next.js 14、React、TypeScript、Tailwind CSS、Shadcn UI
- **后端**：FastAPI、Python、SQLAlchemy
- **数据库**：SQLite（开发环境）
- **AI接口**：OpenAI API、自定义AI服务
- **认证**：JWT认证
- **部署**：Docker（可选）

## 2. 系统架构

### 2.1 整体架构

项目采用前后端分离架构：
- 前端使用Next.js框架，负责用户界面和交互
- 后端使用FastAPI框架，提供RESTful API服务
- 通过API代理解决CORS问题

```
用户 -> 前端应用(Next.js) -> API代理(/api/proxy) -> 后端服务(FastAPI) -> 数据库/AI服务
```

### 2.2 目录结构

#### 前端目录结构
```
frontend/
├── app/                    # Next.js应用目录
│   ├── api/                # API路由
│   ├── auth/               # 认证相关页面
│   ├── components/         # 共享组件
│   ├── context/            # React上下文
│   ├── dashboard/          # 仪表盘页面
│   │   ├── analyze/        # 分析功能
│   │   ├── crazy/          # 疯狂创作功能
│   │   ├── inspiration/    # 灵感功能
│   │   ├── messages/       # 消息功能
│   │   └── writing/        # 写作功能
│   ├── hooks/              # 自定义钩子
│   ├── pricing/            # 定价页面
│   ├── services/           # API服务
│   └── utils/              # 工具函数
├── components/             # UI组件库
├── lib/                    # 工具库
├── public/                 # 静态资源
└── ...
```

#### 后端目录结构
```
ai_novel_backend/
├── bridge/                 # AI服务桥接模块
├── config/                 # 配置文件
├── dao/                    # 数据访问对象
├── database/               # 数据库模型和连接
├── models/                 # 数据模型
├── my_filter/              # 内容过滤模块
├── routes/                 # API路由
├── static/                 # 静态文件
├── util/                   # 工具函数
├── auth.py                 # 认证模块
├── database.py             # 数据库定义
├── main.py                 # 应用入口
├── schemas.py              # 数据模式
└── ...
```

## 3. 数据库设计

### 3.1 主要数据模型

项目使用SQLAlchemy ORM进行数据库操作，主要数据模型包括：

#### 用户模型 (User)
- id: 主键
- account: 用户账号
- email: 电子邮箱
- password: 密码（哈希存储）
- avatar_url: 头像URL
- bio: 个人简介
- total_words: 总字数
- writing_days: 写作天数
- store_count: 作品数量

#### 小说模型 (Novels)
- id: 主键
- user_id: 用户ID（外键）
- title: 小说标题
- description: 小说描述
- is_top: 是否置顶
- is_archive: 是否归档
- created_at: 创建时间
- updated_at: 更新时间

#### 章节模型 (GeneratedChapter)
- id: 主键
- book_id: 小说ID（外键）
- order: 章节顺序
- title: 章节标题
- content: 章节内容
- summary: 章节摘要
- created_at: 创建时间
- updated_at: 更新时间

#### 角色模型 (Character)
- id: 主键
- name: 角色名称
- description: 角色描述
- image_url: 角色图片URL
- user_id: 用户ID（外键）
- prompt: 角色提示词
- is_used: 是否使用
- created_at: 创建时间
- updated_at: 更新时间

#### 任务模型 (Task)
- id: 主键
- user_id: 用户ID（外键）
- task_type: 任务类型
- prompt: 任务提示词
- status: 任务状态
- completion_percentage: 完成百分比
- result_id: 结果ID
- result_type: 结果类型
- created_at: 创建时间
- updated_at: 更新时间

### 3.2 关系图

主要实体关系：
- 用户(1) -> 小说(N)：一个用户可以创建多部小说
- 小说(1) -> 章节(N)：一部小说包含多个章节
- 用户(1) -> 角色(N)：一个用户可以创建多个角色
- 用户(1) -> 任务(N)：一个用户可以创建多个任务

## 4. API设计

### 4.1 认证API

- POST `/auth/login`：用户登录
- POST `/auth/register`：用户注册
- POST `/auth/check_username_available/{username}`：检查用户名是否可用
- POST `/auth/check_email_available/{email}`：检查邮箱是否可用

### 4.2 用户API

- GET `/users/me`：获取当前用户信息
- PUT `/users/update`：更新用户信息
- PUT `/users/update_vip`：更新VIP状态

### 4.3 小说API

- POST `/novels/create`：创建小说
- GET `/novels/{novel_id}`：获取小说详情
- GET `/novels/{user_id}/novel`：获取用户的所有小说
- PUT `/novels/{novel_id}/updateNovel`：更新小说信息
- DELETE `/novels/{novel_id}`：删除小说

### 4.4 章节API

- POST `/novels/{id}/chapters`：添加章节
- PUT `/novels/{id}/chapters/{order}`：更新章节
- GET `/novels/{novel_id}/chapters`：获取小说的所有章节

### 4.5 AI功能API

- POST `/ai/generate-content`：生成小说内容
- POST `/ai/expand-content`：扩展内容
- POST `/ai/polish`：润色内容
- POST `/ai/rewrite`：重写内容
- POST `/ai/generate-image`：生成图片
- POST `/ai/upload-file`：上传文件
- POST `/ai/analyze-file`：分析文件

### 4.6 角色API

- GET `/characters/{user_id}`：获取用户的所有角色
- PUT `/characters/{id}`：更新角色信息

### 4.7 任务API

- POST `/tasks/create`：创建任务
- GET `/tasks/{task_id}/status`：获取任务状态
- GET `/tasks/type/{task_type}/{user_id}`：获取指定类型的任务

## 5. 前端设计

### 5.1 页面结构

- 首页：展示平台介绍和功能
- 认证页：用户登录和注册
- 仪表盘：用户主工作区
  - 写作页：小说创作和编辑
  - 灵感页：生成创作灵感
  - 分析页：内容分析功能
  - 疯狂创作：快速生成内容
  - 消息页：系统消息和通知

### 5.2 主要组件

- 导航组件：提供页面导航
- 侧边栏组件：提供功能导航
- 编辑器组件：小说内容编辑
- AI面板组件：AI辅助功能
- 角色卡组件：角色信息展示
- 作品卡组件：小说作品展示
- 任务卡组件：任务状态展示

### 5.3 状态管理

- 使用React Context API管理全局状态
- localStorage存储用户认证信息（token存储在'token'键下）
- 使用自定义钩子管理复杂状态逻辑

## 6. 后端实现

### 6.1 认证实现

- 使用JWT进行用户认证
- 密码使用bcrypt进行哈希处理
- 实现中间件验证用户身份
- JWT密钥和算法配置在auth.py中

### 6.2 数据库操作

- 使用SQLAlchemy ORM进行数据库操作
- 实现异步数据库访问
- 使用事务确保数据一致性
- 数据模型定义在database.py中

### 6.3 AI服务集成

- 封装OpenAI API调用
- 实现流式响应处理
- 支持多种AI模型配置
- AI服务桥接模块在bridge目录下

### 6.4 内容过滤

- 实现敏感词过滤中间件
- 支持自定义过滤规则
- 对用户输入和AI输出进行内容审查
- 过滤模块在my_filter目录下

## 7. 安全设计

### 7.1 认证安全

- 使用JWT进行身份验证
- 密码哈希存储
- 令牌过期机制
- 在API请求中添加认证令牌到Authorization头（Bearer格式）

### 7.2 API安全

- 请求验证和参数检查
- 权限控制和访问限制
- CORS保护
- 使用Next.js API代理解决跨域问题

### 7.3 内容安全

- 敏感内容过滤
- 用户输入验证
- XSS防护

## 8. 部署方案

### 8.1 开发环境

- 前端：`npm run dev`
- 后端：`python main.py`

### 8.2 生产环境

- 前端：Next.js应用部署到Vercel或自托管服务器
- 后端：FastAPI应用部署到云服务器
- 数据库：使用生产级数据库如PostgreSQL

### 8.3 CI/CD流程

- 代码提交触发自动构建
- 自动化测试
- 自动部署到生产环境

## 9. 功能模块详解

### 9.1 写作模块

写作模块是平台的核心功能，提供小说创作和编辑功能：
- 章节编辑器：支持富文本编辑
- AI辅助写作：提供内容生成、扩展、润色功能
- 自动保存：定期保存用户创作内容
- 字数统计：实时统计创作字数

### 9.2 灵感模块

灵感模块帮助用户获取创作灵感：
- 情节生成：生成故事情节和发展方向
- 角色创建：生成角色背景和特点
- 场景描述：生成场景描述和氛围
- 互动式创作：通过选择引导故事发展

### 9.3 分析模块

分析模块提供内容分析功能：
- 文本分析：分析文本结构和风格
- 情感分析：分析文本情感倾向
- 角色分析：分析角色形象和发展
- 情节分析：分析情节发展和冲突

### 9.4 角色管理

角色管理功能帮助用户管理小说角色：
- 角色创建：创建角色信息和形象
- 角色编辑：编辑角色属性和背景
- 角色关系：定义角色之间的关系
- 角色图像：生成角色图像

### 9.5 支付模块

支付模块提供会员订阅功能：
- 支付宝集成：支持支付宝支付
- 会员订阅：支持会员服务订阅
- 订单管理：管理用户订单和支付状态

## 10. 技术实现细节

### 10.1 前后端通信

- 前端使用fetch API进行HTTP请求
- 后端使用FastAPI处理请求
- API响应使用JSON格式
- 使用JWT进行身份验证
- 在请求头中添加Authorization: Bearer {token}

### 10.2 AI模型集成

- 使用OpenAI API进行内容生成
- 支持流式响应处理
- 支持多种模型配置
- 实现模型参数调整

### 10.3 数据持久化

- 使用SQLAlchemy ORM进行数据库操作
- 实现数据模型映射
- 使用事务确保数据一致性
- 实现数据备份和恢复

### 10.4 用户界面

- 使用Tailwind CSS进行样式设计
- 使用Shadcn UI组件库
- 实现响应式设计
- 支持暗色模式

## 11. 未来规划

### 11.1 功能扩展

- 多语言支持：支持多种语言创作
- 社区功能：用户作品分享和交流
- 移动应用：开发移动端应用
- 语音输入：支持语音输入创作

### 11.2 技术优化

- 性能优化：提高系统响应速度
- 算法改进：优化AI生成质量
- 数据分析：用户行为分析和推荐
- 云存储：支持云端存储和同步

## 12. 总结

NonReal-- AI小说创作系统是一个结合人工智能与创意写作的综合性平台，通过前后端分离架构和现代化技术栈，为用户提供高效、便捷的小说创作体验。平台集成了多种AI辅助功能，包括内容生成、角色创建、灵感获取等，帮助用户突破创作瓶颈，提高创作效率。

项目采用模块化设计，各功能模块相对独立又紧密协作，保证了系统的可扩展性和可维护性。通过JWT认证、内容过滤等安全机制，保障用户数据和创作内容的安全。

未来，平台将继续优化创作逻辑，扩展功能模块，提升用户体验，致力于成为作家创作的得力助手和创意的孵化器。